{source}

<script>

function selectSkill(){
jQuery.ajax({
type: "POST",
url: "https://rtportal.ru/scripts/ajax_lists.php",
data: { action: 'showSkillForInsert'},
cache: false,
success: function(responce){ jQuery('div[name="selectDataSkill"]').html(responce); }
});
};

</script>

<form method="post" action='<?php echo "https://rtportal.ru/index.php/stati/188" ; ?>'>
<script>javascript:selectSkill()</script>

<div name="selectDataSkill"></div>

<input type="submit" value="Отправить"/>
</form>

<?php

#получение выбранной компетенции

$parent_name = strip_tags(trim($_REQUEST['skill']));

 

#подключение sql matrix и установка кодировки

require 'scripts/connect_matrix.php';

mysql_query("SET NAMES 'utf8");
mysql_query("SET CHARACTER SET 'utf8'");

$top=mysql_query("select a.user_slave u_top, a.competency comp, a.parent_name comp_p, avg(a.value) val, avg(a.freq) freq, a.value_date dt, cd.name cnm, count(a.user_main) ucnt 
from competency_v a, competency_dict cd 
where value_date = (select max(value_date) from competency_v b where a.user_main = b.user_main and a.competency = b.competency) 
and a.competency=cd.value 
and a.parent_name='$parent_name'
group by a.competency, a.user_slave 
order by val desc, ucnt desc") or die(mysql_error());

$arr_top=mysql_fetch_array($top);

$inow=1;

echo "<TABLE BORDER align='center' class='table_sort'>
<p><b>TOP по компетенции: </b></p>
<TR>

<TD ALIGN=CENTER><b>№ в рейтинге</b></TD>
<TD ALIGN=CENTER><b>пользователь</b></TD>
<TD ALIGN=CENTER><b>компетенция</b></TD>
<TD ALIGN=CENTER><b>средняя оценка</b></TD>
<TD ALIGN=CENTER><b>количество оценивших</b></TD>
</TR>";

        do
            {
                printf("<TR>

<TD ALIGN=CENTER>".$inow++."</TD>   
<TD ALIGN=CENTER>".JFactory::getUser($arr_top['u_top'])->name."</TD>
<TD ALIGN=CENTER>".$arr_top['comp_p']."</TD>
<TD ALIGN=CENTER>".$arr_top['val']."</TD>
<TD ALIGN=CENTER>".$arr_top['ucnt']."</TD>

                </TR>");
            }
        while ($arr_top = mysql_fetch_array($top));
        
    echo "</table><br>";

?> 

{/source}

Оценка по матрице компетенций
